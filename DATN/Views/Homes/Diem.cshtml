
@{
	ViewBag.Title = "Diem";
	Layout = "~/Views/Share/_Layout.cshtml";
}
<div class="card text-center">
	<div class="page-header" style="margin:10px">
		@*<h3 class="page-title">
				Bản điểm
			</h3>*@
		<nav aria-label="breadcrumb">
			<ol class="breadcrumb" style="margin-left: 45px">
				<li class="breadcrumb-item active" id="item0"><button type="button" class="btn btn-outline-dark btn-rounded btn-fw font-fam">Toàn bộ điểm</button></li>

				<li class="breadcrumb-item active" id="item3"><button type="button" class="btn btn-outline-success btn-rounded btn-fw font-fam">Điểm A</button></li>

				<li class="breadcrumb-item active" id="item4"><button type="button" class="btn btn-outline-info btn-rounded btn-fw font-fam">Điểm B</button></li>

				<li class="breadcrumb-item active" id="item5"><button type="button" class="btn btn-outline-primary btn-rounded btn-fw font-fam">Điểm C</button></li>

				<li class="breadcrumb-item active" id="item2"><button type="button" class="btn btn-outline-warning btn-rounded btn-fw font-fam">Cần cải thiện</button></li>

				<li class="breadcrumb-item active" id="item1"><button type="button" class="btn btn-outline-danger btn-rounded btn-fw font-fam">Chưa đạt</button></li>



			</ol>
		</nav>
	</div>
</div>

<div class="card" style=" margin-top:20px">
	<div class="card-body">
		<table class="table table-hover nowrap" id="example" style="width:100%">
			<thead>
				<tr>
					<th>Mã môn</th>
					<th>Tên môn</th>
					<th>Học kì</th>
					<th>Số TC</th>
					<th>
						Thi L1
					</th>
					<th>
						Thi L2
					</th>

					@*<th>
							Thi L3
						</th>*@
					<th>
						TK(10)
					</th>
					<th class="tkch">
						TK(CH)
					</th>
					<th>
						KQ1
					</th>

					<th class="kq">
						KQ
					</th>

					<th>
						Gợi ý
					</th>

				</tr>
			</thead>
			<tbody>
				@foreach (var item in ViewBag.Diem)
				{
					//if (@item._KQ1 == "Đạt")
					//{
					if (item.KQ == "X")
					{
						<tr class="table-danger">

							<td>@item.MaMon</td>
							<td>@item.TenMon</td>
							<td>@item.HocKi</td>
							<td>@item.TinChi</td>
							<td>@item.ThiL1</td>
							<td>@item.ThiL2</td>
							@*<td>@item.ThiL3</td>*@
							<td>@item.TK10</td>
							<td>@item.TKCH</td>
							<td>@item.KQ1</td>
							<td>@item.KQ</td>
							<td>
								<a class="nav-link mdi mdi-arrow-down-drop-circle" style="text-align:center;color: #7400e8;font-size:25px;" id="SuggestionsDropdown" href="#" data-toggle="dropdown" aria-expanded="false">
								</a>
								<div class="dropdown-menu navbar-dropdown" aria-labelledby="SuggestionsDropdown">
									<a class="dropdown-item" href="#" data-id="@item.MaMon" onclick="ShowLich(@item.MaMon)">
										<i class="mdi mdi-calendar-clock mr-2 text-success"></i>
										Xem lịch học
									</a>
									<div class="dropdown-divider"></div>
									<a class="dropdown-item" href="#" data-id="@item.ID_Mon" onclick="ShowFriend(@item.ID_Mon)">
										<i class="mdi mdi-account-multiple mr-2 text-primary"></i>
										Tìm bạn học chung
									</a>
								</div>
							</td>
						</tr>
					}
					else if (item.TKCH == "D" || item.TKCH == "C" || item.TKCH == "D+")
					{
						<tr class="table-warning">

							<td>@item.MaMon</td>
							<td>@item.TenMon</td>
							<td>@item.HocKi</td>
							<td>@item.TinChi</td>
							<td>@item.ThiL1</td>
							<td>@item.ThiL2</td>
							@*<td>@item.ThiL3</td>*@
							<td>@item.TK10</td>
							<td>@item.TKCH</td>
							<td>@item.KQ1</td>
							<td>@item.KQ</td>
							@*<td>
									<a style="padding:0" class="btn btn-showlich" data-id="@item.MaMon" onclick="ShowLich(@item.MaMon)">
										<i class="mdi mdi-account-multiple" style="color: #b66dff;padding:4px 5px;font-size:20px;border: 1px solid #d8d8d8; border-radius: 20px"></i>
									</a>
								</td>*@
							<td>
								<a class="nav-link mdi mdi-arrow-down-drop-circle" style="text-align:center;color: #7400e8;font-size:25px;" id="SuggestionsDropdown" href="#" data-toggle="dropdown" aria-expanded="false">
								</a>
								<div class="dropdown-menu navbar-dropdown" aria-labelledby="SuggestionsDropdown">
									<a class="dropdown-item" href="#" data-id="@item.MaMon" onclick="ShowLich(@item.MaMon)">
										<i class="mdi mdi-calendar-clock mr-2 text-success"></i>
										Xem lịch học
									</a>
									<div class="dropdown-divider"></div>
									<a class="dropdown-item" href="#" data-id="@item.ID_Mon" onclick="ShowFriend(@item.ID_Mon)">
										<i class="mdi mdi-account-multiple mr-2 text-primary"></i>
										Tìm bạn học chung
									</a>
								</div>
							</td>
							@*<td>@item.GhiChu</td>*@
						</tr>
					}

					else
					{
						<tr>
							<td>@item.MaMon</td>
							<td>@item.TenMon</td>
							<td>@item.HocKi</td>
							<td>@item.TinChi</td>
							<td>@item.ThiL1</td>
							<td>@item.ThiL2</td>
							@*<td>@item.ThiL3</td>*@
							<td>@item.TK10</td>
							<td>@item.TKCH</td>
							<td>@item.KQ1</td>
							<td>@item.KQ</td>
							<td></td>
						</tr>
					}


				}
			</tbody>
		</table>
	</div>
</div>

@*Modal upload lich*@
<div class="card modal" id="model-data">
	<div class="card-body">

		<div class="row">
			<div class="col-md-12">
				<h3 class="table-title text-center"></h3>
				<table class="table table-hover nowrap" id="table-data" style="width:100%">
					<thead>
						
					</thead>
					<tbody></tbody>
				</table>
			</div>
		</div>
	</div>
</div>
@section ClientScript{

	<script>

		$(document).ready(function () {
			var table = $('#example').DataTable({
				responsive: true,
				"lengthMenu": [[30, 40, 50, -1], [30, 40, 50, "All"]],
				"pagingType": "first_last_numbers",
				"showNEntries": false,
				"bInfo": false,
				"autoWidth": true,
				lengthChange: false,
				buttons: [

					{ extend: 'excel', filename: 'Bảng điểm - @Session["name"]', messageTop:'Bảng điểm - @Session["name"]' },
					{ extend: 'pdf', filename: 'Bảng điểm - @Session["name"]' },
					{ extend: 'print', filename: 'Bảng điểm - @Session["name"]', title: 'Bảng điểm - @Session["name"]' },
					'colvis'
				]
			});
			table.buttons().container()
				.appendTo('#example_wrapper .col-md-6:eq(0)');
			$('.buttons-colvis').html("Loại cột");

			$("#item1").on("click", function () {
				table
					.search('')
					.columns().search('')
					.draw();

				table.column(".kq").search("X").draw();

			});

			$("#item2").on("click", function () {
				table
					.search('')
					.columns().search('')
					.draw();

				table.column(".tkch").search("D").draw();

			});

			$("#item3").on("click", function () {
				table
					.search('')
					.columns().search('')
					.draw();

				table.column(".tkch").search("A").draw();

			});

			$("#item4").on("click", function () {
				table
					.search('')
					.columns().search('')
					.draw();

				table.column(".tkch").search("B").draw();

			});

			$("#item5").on("click", function () {
				table
					.search('')
					.columns().search('')
					.draw();

				table.column(".tkch").search("C").draw();

			});

			$("#item0").on("click", function () {

				table
					.search('')
					.columns().search('')
					.draw();

			});


		});
		// Hàm show lịch học
		function ShowLich(Ma_Mon) {
			var url = "/Lich/ShowLich?Ma_Mon=" + Ma_Mon;
			var table = $('#table-data tbody');
			
			var table_header = $('#table-data thead');
			table_header.empty();
			var header = '<tr>';
			header += '<th>Mã môn</th>';
			header += '<th>Tên môn</th>';
			header += '<th>Lớp</th>';
			header += '<th>Thứ</th>';
			header += '<th>Phòng</th>';
			header += '<th>Thời gian</th>';
			header += '</tr>';
			header += '</thead>';
			table_header.append(header);

			var obj;
			$.ajax({
				method: "GET",
				url: url,
				success: function (data) {
					obj = JSON.parse(data);
					console.log(obj);
					load_data(obj);
				}

			});
			// Load data khi bấm vào button xem lịch học
			function load_data(mydata) {
				table.empty();
				var data_lich = '';


				if (!Object.keys(obj).length) {
					data_lich += '<tr>';
					data_lich += '<td colspan="6" style="text-align: center; font-size: 15px">' + 'Chưa mở lớp. Liên hệ phòng đào tạo để mở lớp.' + '</td>';
					data_lich += '</tr>';
				}
				$.each(obj, function (key, value) {
					data_lich += '<tr>';
					data_lich += '<td>' + value.Ma_MH + '</td>';
					data_lich += '<td>' + value.Ten_MH + '</td>';
					data_lich += '<td>' + value.Lop + '</td>';
					data_lich += '<td>' + value.Thu + '</td>';
					data_lich += '<td>' + value.Phong + '</td>';
					data_lich += '<td>' + value.Thoi_Gian + '</td>';
					data_lich += '</tr>';
				});
				$('.table-title').html('Danh sách các lớp đang mở');
				table.append(data_lich);
			}
			$('#model-data').modal({
			    showClose: false,
			    fadeDuration: 200,
			});
		}

		//Hàm tìm bạn học chung
		function ShowFriend(ID_Mon) {
			var url = "/Lich/ShowFriend?id=" + ID_Mon;
			var table_header = $('#table-data thead');
			table_header.empty();
			var header = '<tr>';
				header += '<th>Mã môn</th>';
				header += '<th>Mã sinh viên</th>';
				header += '<th>Tên sinh viên</th>';
				header += '<th>Số điện thoại</th>';
				header += '<th>Lớp</th>';
				header += '<th>Điểm kết thúc</th>';
				header += '</tr>';
			header += '</thead>';
			table_header.append(header);
			var table = $('#table-data tbody');
			var obj;
			$.ajax({
				method: "GET",
				url: url,
				success: function (data) {
					obj = JSON.parse(data);
					console.log(obj);
					load_data_friend(obj);
				}

			});
			function load_data_friend(mydata) {
				table.empty();
				var tenmon;
				var data_friend = '';
				if (!Object.keys(obj).length) {
					data_friend += '<tr>';
					data_friend += '<td colspan="6" style="text-align: center; font-size: 15px">' + 'Không tìm thấy, vui lòng liên hệ phòng đào tạo để được mở lớp.' + '</td>';
					data_friend += '</tr>';
				}
				$.each(obj, function (key, value) {
					data_friend += '<tr>';
					data_friend += '<td>' + value.Ma_Mon + '</td>';
					data_friend += '<td>' + value.Ma_SV + '</td>';
					data_friend += '<td>' + value.Ho_Ten + '</td>';
					data_friend += '<td>' + value.SDT + '</td>';
					data_friend += '<td>' + value.Lop + '</td>';
					data_friend += '<td>' + value.Diem_KT + '</td>';
					data_friend += '</tr>';
					tenmon = value.Ten_Mon;
				});
				table.append(data_friend);
				$('.table-title').html('Danh sách sinh viên có thể học lại môn: ' + tenmon);
			}
			$('#model-data').modal({
				showClose: false,
				fadeDuration: 200,
			});
		}

	</script>
}


<style>
	.table-warning, .table-warning > th, .table-warning > td {
		background: #ffe76e;
	}

	.btn-fw {
		min-width: 80px;
	}

	.font-fam {
		font-family: serif;
		font-size: 15px;
	}

	#model-data {
		max-width: none;
	}
	/*#item1 {
			background: #ff6889;
			color: white;
			padding: 5px;
			border-radius: 5px;
			margin-right: 10px;
			cursor: pointer;
		}

		#item2 {
			background: #ffe76e;
			color: white;
			padding: 5px;
			border-radius: 5px;
			cursor: pointer;
		}

		#item0 {
			margin-right: 10px;
			background: #808080;
			color: chartreuse;
			padding: 5px;
			border-radius: 5px;
			cursor: pointer;
		}*/
	.breadcrumb-item + .breadcrumb-item::before {
		content: ""
	}


	.blocker {
		z-index: 99;
	}
</style>

